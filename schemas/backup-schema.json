{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ModulTool Backup",
  "type": "object",
  "additionalProperties": false,
  "required": ["manifest", "state"],
  "properties": {
    "manifest": {
      "type": "object",
      "additionalProperties": false,
      "required": ["generatedAt", "version", "theme", "modules", "plugins", "archives", "playlist", "settings"],
      "properties": {
        "generatedAt": { "type": "string", "format": "date-time" },
        "version": { "type": "string", "minLength": 1 },
        "theme": { "type": "string", "minLength": 1 },
        "modules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "name"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "name": { "type": "string", "minLength": 1 }
            }
          }
        },
        "plugins": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "name", "version", "moduleId"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "name": { "type": "string", "minLength": 1 },
              "version": { "type": "string" },
              "moduleId": { "type": "string", "minLength": 1 }
            }
          }
        },
        "archives": {
          "type": "object",
          "additionalProperties": false,
          "required": ["genres", "moods", "categories"],
          "properties": {
            "genres": { "type": "integer", "minimum": 0 },
            "moods": { "type": "integer", "minimum": 0 },
            "categories": { "type": "integer", "minimum": 0 }
          }
        },
        "playlist": { "type": "integer", "minimum": 0 },
        "settings": {
          "type": "object",
          "additionalProperties": false,
          "required": ["autosave", "selfrepair", "toasts"],
          "properties": {
            "autosave": { "type": "boolean" },
            "selfrepair": { "type": "boolean" },
            "toasts": { "type": "boolean" },
            "respectSystemMotion": { "type": "boolean" },
            "reduceMotion": { "type": "boolean" },
            "respectSystemContrast": { "type": "boolean" },
            "highContrast": { "type": "boolean" },
            "fontScale": { "type": "integer", "enum": [14, 16, 18, 20] },
            "configPreset": {
              "type": "string",
              "enum": ["balanced", "accessibility", "focus", "performance", "custom"]
            },
            "layoutPreset": {
              "type": "string",
              "enum": [
                "balanced",
                "modules-wide",
                "audio-wide",
                "module-only",
                "audio-only",
                "workspace",
                "stacked"
              ]
            }
          }
        }
      }
    },
    "state": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "theme",
        "autosave", 
        "selfrepair", 
        "toasts", 
        "modules", 
        "categories", 
        "genres",
        "moods",
        "playlist",
        "plugins",
        "activeModule",
        "log",
        "logFilter"
      ],
      "properties": {
        "theme": { "type": "string", "minLength": 1 },
        "autosave": { "type": "boolean" },
        "selfrepair": { "type": "boolean" },
        "toasts": { "type": "boolean" },
        "respectSystemMotion": { "type": "boolean" },
        "reduceMotion": { "type": "boolean" },
        "respectSystemContrast": { "type": "boolean" },
        "highContrast": { "type": "boolean" },
        "fontScale": { "type": "integer", "enum": [14, 16, 18, 20] },
        "configPreset": {
          "type": "string",
          "enum": ["balanced", "accessibility", "focus", "performance", "custom"]
        },
        "layoutPreset": {
          "type": "string",
          "enum": [
            "balanced",
            "modules-wide",
            "audio-wide",
            "module-only",
            "audio-only",
            "workspace",
            "stacked"
          ]
        },
        "modules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "name"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "name": { "type": "string", "minLength": 1 }
            }
          }
        },
        "categories": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "required": ["genres", "moods"],
            "properties": {
              "genres": {
                "type": "array",
                "items": { "type": "string", "minLength": 1 },
                "uniqueItems": true
              },
              "moods": {
                "type": "array",
                "items": { "type": "string", "minLength": 1 },
                "uniqueItems": true
              }
            }
          }
        },
        "genres": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true
        },
        "moods": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true
        },
        "playlist": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "title", "artist", "src"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "title": { "type": "string" },
              "artist": { "type": "string" },
              "src": { "type": "string", "minLength": 1 }
            }
          }
        },
        "plugins": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "name", "moduleId", "moduleName"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "name": { "type": "string", "minLength": 1 },
              "description": { "type": "string" },
              "version": { "type": "string" },
              "author": { "type": "string" },
              "moduleId": { "type": "string", "minLength": 1 },
              "moduleName": { "type": "string", "minLength": 1 },
              "sections": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["title", "content"],
                  "properties": {
                    "title": { "type": "string" },
                    "content": { "type": "string" }
                  }
                }
              },
              "links": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["label", "url"],
                  "properties": {
                    "label": { "type": "string", "minLength": 1 },
                    "url": { "type": "string", "format": "uri" }
                  }
                }
              }
            }
          }
        },
        "activeModule": {
          "anyOf": [
            { "type": "string", "minLength": 1 },
            { "type": "null" }
          ]
        },
        "log": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["time", "type", "msg"],
            "properties": {
              "time": { "type": "string", "minLength": 1 },
              "type": { "type": "string", "enum": ["info", "ok", "warn", "error"] },
              "msg": { "type": "string" }
            }
          }
        },
        "logFilter": {
          "type": "string",
          "enum": ["all", "info", "ok", "warn", "error"]
        }
      }
    }
  }
}
